<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>3D GLB Viewer</title>
    <style>
      html, body { margin:0; width:100%; height:100%; overflow:hidden; background:#f4f4f4; }
      #app { width:100vw; height:100vh; }
      #hud{
        position:fixed; left:12px; top:12px; z-index:10;
        font:14px system-ui; background:rgba(0,0,0,.75); color:#fff;
        padding:8px 12px; border-radius:10px; max-width: calc(100vw - 24px);
        word-break: break-word;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <div id="hud">Booting…</div>

    <script type="module">
      const app = document.getElementById("app");
      const hud = document.getElementById("hud");
      const setHUD = (m) => (hud.textContent = m);

      setHUD("Starting JS…");

      async function main() {
        try {
          setHUD("Importing Three.js…");

          // Switch CDN (often more reliable than jsDelivr in some networks)
          const THREE = await import("https://esm.sh/three@0.160.0");
          const { OrbitControls } = await import("https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js");
          const { GLTFLoader } = await import("https://esm.sh/three@0.160.0/examples/jsm/loaders/GLTFLoader.js");

          setHUD("Setting up scene…");

          const scene = new THREE.Scene();

          const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 5000);

          const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
          renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
          renderer.setSize(window.innerWidth, window.innerHeight);
          app.appendChild(renderer.domElement);

          scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.0));
          const dir = new THREE.DirectionalLight(0xffffff, 1.2);
          dir.position.set(3, 4, 5);
          scene.add(dir);

          const controls = new OrbitControls(camera, renderer.domElement);
          controls.enableDamping = true;
          controls.enablePan = false;

          const MODEL_URL = "./TeST2.glb";
          setHUD("Loading TeST2.glb…");

          const loader = new GLTFLoader();
          loader.load(
            MODEL_URL,
            (gltf) => {
              const model = gltf.scene;
              scene.add(model);

              const box = new THREE.Box3().setFromObject(model);
              const size = box.getSize(new THREE.Vector3());
              const center = box.getCenter(new THREE.Vector3());
              model.position.sub(center);

              const maxDim = Math.max(size.x, size.y, size.z);
              camera.position.set(0, maxDim * 0.3, maxDim * 2.2);
              controls.target.set(0, 0, 0);
              controls.update();

              setHUD("Ready — drag to rotate, scroll to zoom");
            },
            (xhr) => {
              if (xhr.total) setHUD(`Loading… ${Math.round((xhr.loaded / xhr.total) * 100)}%`);
            },
            (err) => {
              console.error(err);
              setHUD("ERROR: TeST2.glb failed to load (check 404 / filename case).");
            }
          );

          window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
          });

          function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
          }
          animate();

        } catch (e) {
          console.error(e);
          setHUD("IMPORT ERROR: " + (e?.message || e));
        }
      }

      main();
    </script>
  </body>
</html>
